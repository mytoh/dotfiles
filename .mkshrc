
# variables
blue="[38;5;004m"
normal_color="[38;5;8m"
green="[38;5;6m"
reset_color="[0m"

# prompt
function precmd {
  local e=$?

  (( e )) && print -n "$e|"
}


function current_directory {
	local d=${PWD:-?} p=~; [[ $p = ?(*/) ]] || \
	d=${d/#$p/~}; local m=${%d} n p=...; (( m > 0 )) || m=${#d}
	(( m > (n = (COLUMNS/3 < 7 ? 7 : COLUMNS/3)) )) && d=${d:(-n)} || \
	p=; print -nr -- "$p$d"
}

function set-prompt {
printf "%s%s%s\n%s"       \
  "${blue}${precmd}" "${normal_color}â”Œâ”€$reset_color" "${normal_color}(${blue}$(current_directory)${normal_color})"  \
       "${normal_color}â””â”ˆâ•¸${reset_color} "
    

}
PS1='$(set-prompt)'

# environmet variables

# path setting {{{
# for p in /opt/X11/bin/         \
#         ~/local/homebrew/bin  \
#         ~/local/homebrew/sbin \
#         ~/local/bin           \
# do
#   [[ -d $p/. ]] || \
#   [[ :$PATH: = *:$p:* ]] || \
#     PATH=${p}:${PATH}
# done

for p in \
     /opt/X11/bin \
    ~/local/homebrew/bin \
    ~/local/homebrew/sbin \
    ~/local/bin
  do
	[[ -d $p/. ]] || continue
	[[ :$PATH: = *:$p:* ]] || PATH=$p:$PATH
done
#}}}

MKSH=$(whence -p mksh)
[[ $HOSTNAME = @(localhost|*([	 ])) ]] && HOSTNAME=$(ulimit -c 0;hostname 2>&-)
export HOSTNAME
export SHELL=$MKSH MANWIDTH=80 LESSHISTFILE=-
export HISTFILE=~/.mksh_history
export HISTSIZE=999999
export GAUCHE_LOAD_PATH=~/.gosh
if [[ -d $HOME/local/stow ]]; then
  export STOW=$HOME/local/stow
fi

export CDPATH=~/local:~/local/var

#}}}

# functions {{{

# give MidnightBSD's laffer1 a bit of csh feeling
function setenv() {
	eval export $1'="$2"'
}

if whence -p gosh >&- && [[ -e $GAUCHE_LOAD_PATH/ls.scm ]]; then
function cd {
	builtin cd $@
  gosh ls.scm -d
}
else
  function cd {
  buitin cd $@
}
fi

function tm() {
    tmux attach
}

function color-numbers() {
  for i in $(seq 000 16 255)
  do
    for j in $(seq ${i} $((i + 15)))
    do
      echo -en "[38;5;${j}m $j [0m"
    done
    echo
  done
}

function xsource() { # {{{
# from grml zshrc
# Check if we can read given files and source those we can.
    if (( $# < 1 )) ; then
        printf 'usage: xsource FILE(s)...\n' >&2
        return 1
    fi

    while (( $# > 0 )) ; do
        [[ -r "$1" ]] && source "$1"
        shift
    done
    return 0
}
#}}}

# aliases {{{
if whence -p gosh >&- ; then
    alias yotsuba='gosh yotsuba-get.scm'
    alias futaba='gosh futaba-get.scm'
    alias spc2ubar='gosh space2underbar.scm'
    alias ea='gosh extattr.scm'
  if [[ -e $GAUCHE_LOAD_PATH/ls.scm ]]; then
    alias ls='gosh ls.scm -d'
    alias la='gosh ls.scm -d -a'
    alias ll='gosh ls.scm -d -psf'
    alias lla='gosh ls.scm -d -psf -a'
    alias l='gosh ls.scm -d'
  fi
fi

alias which='whence -p'
#}}}

# key bindings
bind '^P'=search-history-up

# misc {{{
if [[ -e $HOME/local/git/f/f.sh ]]; then
  xsource $HOME/local/git/f/f.sh
  alias z='f -d -e cd'
  alias v='f -e vim'
  alias m='f -e mplayer'
  alias o='f -e xdg-open'
fi
#}}}





unset p
