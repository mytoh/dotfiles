#!/bin/tcsh

set date_format = '%a %d/%m %H:%M'
set icons = $HOME/.dzen/icons
set interval = 1


while (1)
  set date = `date +"$date_format"`

  set cpu = `top -b -d 2 | grep ^CPU | gawk '{print $2,$6}'`

  set rx = `bwm-ng -o plain -c 1 -I em0 -T avg| grep em0 | gawk '{print $2,$3}'`

  set tx = `bwm-ng -o plain -c 1 -I em0 -T avg| grep em0 | gawk '{print $4,$5}'`

  set freemem = `vmstat -h |grep -n 2| gawk '{print $6}'`

  set battery = `sysctl -n hw.acpi.battery.life`

  if ( $battery <= 100 && $battery > 50 ) then 
   set baticon = "$icons/sm4tik/bat_full_01.xbm";
  else if ( $battery >= 10 && $battery <= 50 ) then 
   set baticon = "$icons/sm4tik/bat_low_01.xbm";
  else 
   set baticon = "$icons/sm4tik/bat_empty_01.xbm";
  endif

  set batcolour = `sysctl -n hw.acpi.battery.state`

  if ( $batcolour == 1 ) then
      set batcolour = "#303030";
  else if ( $batcolour == 2 ) then
      set batcolour = "#00dddd";
  endif

# set diskusr = `df -h | grep ad4s1f | gawk '{print $4}'`
  set diskused = `gdf | gawk '{if ( $3 !~ /Used/ ) { a += $3} } END {a=a/(1024*1024);print int(a)}'`

  echo "^fg(#93ab39)^i($icons/sm4tik/cpu.xbm)^fg() $cpu  ^fg(#937473)^i($icons/sm4tik/mem.xbm)^fg() $freemem  ^fg(#fa3b99)^i($icons/sm4tik/net_up_02.xbm)^fg() $tx ^fg(#ff8600)^i($icons/sm4tik/net_down_02.xbm)^fg() $rx  ^fg(#cdcdcd)^i($icons/sm4tik/fs_01.xbm)^fg() ${diskused}GB ^fg($batcolour)^i($baticon)^fg() ${battery}% ^fg(#2717fc)^i($icons/sm4tik/clock.xbm)^fg() $date "

#  sleep $interval

end 

##dzen2 -p -ta r -x 400 -y 0 -w 880 -h 12 -fn '-adobe-helvetica-medium-r-normal--11-*' -e 'onexit=ungrabmouse'

